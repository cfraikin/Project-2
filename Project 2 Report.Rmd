---
title: "Project 2 Report"
author: "Chanel Fraikin and Benjamin Kelly"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: true
    toc_depth: 3
header-includes:
  - \usepackage{booktabs}
  - \usepackage{longtable}
  - \usepackage{array}
  - \usepackage{multirow}
  - \usepackage{wrapfig}
  - \usepackage{float}
  - \usepackage{colortbl}
  - \usepackage{pdflscape}
  - \usepackage{tabu}
  - \usepackage{threeparttable}
  - \usepackage{threeparttablex}
  - \usepackage[normalem]{ulem}
  - \usepackage{makecell}
  - \usepackage{xcolor}
---

```{r setup, include = FALSE}

#### Load necessary packages ####
# * These packages are not necessary to complete the assignment and or only used 
#   to provide an example. 
packages <- c("knitr", "kableExtra", "magrittr", "readr", "geosphere", "dplyr",
              "tidyr", "ggplot2", "scales", "leaflet", "htmltools")

install_me <- packages[!(packages %in% installed.packages()[, "Package"])]
if (length(install_me)) install.packages(install_me)

library(knitr)
library(kableExtra)
library(magrittr)
library(readr)
library(geosphere)
library(dplyr)
library(tidyr)
library(ggplot2)
library(scales)
library(leaflet)
library(htmltools)
```

# Global Trajectory
```{r obj1}
# Load Datasets
confirmed_ds<-read.csv("time_series_covid19_confirmed_global.csv", 
                       header=TRUE, stringsAsFactors=FALSE)
recovered_ds<-read.csv("time_series_covid19_recovered_global.csv", 
                       header=TRUE, stringsAsFactors=FALSE)
deaths_ds<-read.csv("time_series_covid19_deaths_global.csv", 
                    header=TRUE, stringsAsFactors=FALSE)

# Get totals per day through summation
confirmed_sum<-confirmed_ds%>%select(-(1:4))%>%summarise_all(sum)
recovered_sum<-recovered_ds%>%select(-(1:4))%>%summarise_all(sum)
death_sum<-deaths_ds%>%select(-(1:4))%>%summarise_all(sum)

# Merge datasets into one and add column for categories
dat <- rbind(confirmed_sum, recovered_sum, death_sum)
dat$dataset <- factor(c(rep("Confirmed", dim(confirmed_sum)[1]),
                        rep("Recovered", dim(recovered_sum)[1]),
                        rep("Deaths", dim(death_sum)[1])))

data_long <- gather(dat, Dates, SumCases, -dataset, factor_key=TRUE)

# Create Plot
ggplot(data_long, aes(x=Dates, y=SumCases, color=dataset)) + 
  scale_color_discrete(breaks=c("Confirmed", "Recovered", "Deaths")) +
  geom_point() + ggtitle("Global Trajectory for COVID-19") + 
  scale_x_discrete(breaks=c("X2.1.20","X3.1.20","X4.1.20", "X5.1.20"),
                   labels=c("Feb", "Mar", "Apr", "May")) +
  labs(y= "Cases", x = "Date") +
  scale_y_continuous(breaks=pretty_breaks(n=5), 
                     labels=scales::comma)

```

# Global Map
```{r obj2}
last_date <- names(confirmed_ds)[ncol(confirmed_ds)]
confirmed_last<-confirmed_ds%>%select(Province.State, Country.Region, 
                                      Lat, Long, starts_with(last_date))
recovered_last<-recovered_ds%>%select(Province.State, Country.Region, 
                                      Lat, Long, starts_with(last_date))
deaths_last<-deaths_ds%>%select(Province.State, Country.Region, 
                                Lat, Long, starts_with(last_date))

names(confirmed_last)[ncol(confirmed_last)]<-"Total"
names(recovered_last)[ncol(recovered_last)]<-"Total"
names(deaths_last)[ncol(deaths_last)]<-"Total"

dat <- rbind(confirmed_last, recovered_last, deaths_last)
dat$dataset <- factor(c(rep("Confirmed", dim(confirmed_last)[1]),
                        rep("Recovered", dim(recovered_last)[1]),
                        rep("Deaths", dim(deaths_last)[1])))

# Create a palette that maps factor levels to colors
pal <- colorFactor(c("blue", "cyan", "red"),
                   domain = c("Confirmed", "Recovered", "Deaths"))

leaflet(dat) %>% addTiles() %>%
  addCircles(
    radius = ~sqrt(dat$Total)*1000,
    color = ~pal(dataset),
    stroke = TRUE, 
    fillOpacity = 0.4,
    group = ~dataset,
    label = paste(ifelse(dat$Province.State == "", 
                         dat$Country.Region, 
                         dat$Province.State)),
    popup = paste(dat$dataset, ": ", dat$Total, sep="")
    ) %>%
  addLayersControl(
    overlayGroups = c("Confirmed", "Recovered", "Deaths"),
    options = layersControlOptions(collapsed = FALSE)
    ) 
```

# Narrowing Down Hot Spots
```{r obj3}


```

# Zooming Into Our State
```{r obj4}


```

# Digging Deeper
```{r obj5}


```

